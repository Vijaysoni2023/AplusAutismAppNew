@model IEnumerable<aplusautism.Bal.DTO.ABuserDTO>

<style>
    .overlay {
        display: none;
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 999;
        background: rgba(255,255,255,0.8) url("../../../../wwwroot/images/loading.gif") center no-repeat;
    }

    body {
        text-align: center;
    }
        /* Turn off scrollbar when body element has the loading class */
        body.loading {
            overflow: hidden;
        }
            /* Make spinner image visible when body element has the loading class */
            body.loading .overlay {
                display: block;
            }
</style>

<div class="overlay"></div>


<div class="main-content container-fluid">
    <div class="users" style="pointer-events: all;">
        <h4 class="mb-2 text-muted text-bold">Client Details</h4>
        <div class="card">
            <div class="card-body">
                <div class="mb-2 row">
                    <div class="col">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group row mx-0">
                                    <label class="col-sm-auto col-form-label"><b>Clients:</b></label>
                                    <div class="col-sm-8">

                                        <select placeholder="ActiveDDL" class="form-control" id="ActiveDDL" name="ActiveDDL">
                                            <option value="">--Choose Status--</option>
                                            @foreach (var statusdata in (List<aplusautism.Bal.DTO.GlobalCodesDTO>)ViewBag.ClientStatusList)
                                            {
                                               
                                                    <option value="@statusdata.GlobalCodeValue">@statusdata.GlobalCodeName</option>
                                                
                                                
                                            }

                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-responsive" id="tablediv">
                    <table id="clientdetails" class="table-bordered table table-sm">
                        <thead>
                            <tr>
                                @*<th style="text-align:left;">
                                    Created Date<span class="sort-direction"></span>
                                </th>*@
                                <th style="text-align:left;">
                                    Name of Client<span class="sort-direction"></span>
                                </th>
                                <th style="text-align:left;">
                                    Email<span class="sort-direction"></span>
                                </th>
                                <th style="text-align:left;">
                                    Country<span class="sort-direction"></span>
                                </th>
                               @* <th style="text-align:left;">
                                    State<span class="sort-direction"></span>
                                </th>
                                <th style="text-align:left;">
                                    City<span class="sort-direction"></span>
                                </th>*@
                                <th style="text-align:left;">
                                    Start Date<span class="sort-direction"></span>
                                </th>
                                <th style="text-align:left;">
                                    End Date <span class="sort-direction"></span>
                                </th style="text-align:right;">
                                <th style="text-align:left;">
                                    Created Date<span class="sort-direction"></span>
                                </th>
                                @* <th style="text-align:left;">
                                    <span class="sort-direction"></span>
                                </th>*@
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>

                             @* @if (@ViewBag.clientdatalist != null)
                            {
                            @foreach (var clientdata in (List<aplusautism.Bal.DTO.ABuserDTO>)ViewBag.clientdatalist)
                            {
                            <tr>
                            <td style="display:none;">@clientdata.CreatedDate</td>
                            <td><a href="~/Admin/CustSubscription/ClientProfile?ClientId=@clientdata.AB_UserID&Clientstatus=@ViewBag.Status">@clientdata.FormatedName</a></td>
                            <td><a href="~/Admin/CustSubscription/ClientProfile?ClientId=@clientdata.AB_UserID&Clientstatus=@ViewBag.Status">@clientdata.Email</a></td>
                            <td>@clientdata.StartDateFormat</td>
                            <td>@clientdata.EndDateFormat</td>

                            @if (clientdata.StatusName == "Active")
                            {
                            <td>
                            <a href="#active_modal" data-toggle="modal" class="activate" style="color:green;">@clientdata.StatusName</a>
                            </td>
                            }
                            else
                            {
                            <td>
                            <a href="#active_modal" data-toggle="modal" class="activate" style="color:red;">Inactive</a>
                            </td>
                            }

                            <td class="actionsbtn">
                            <a type="button" title="Reminder" class="btn btn-link btn-sm reminder" href="javascript:void(0)" onclick="SendMailNotification(@clientdata.AB_UserID)">
                            <i class='bx bxs-bell-ring text-danger'></i>
                            </a>
                            <a type="button" title="Suspend" class="btn btn-link btn-sm suspend" href="javascript:void(0)" onclick="Suspend(@clientdata.AB_UserID)">
                            <i class='bx bx-pause-circle text-success font-size-18'></i>
                            </a>
                            <a type="button" title="Extend trial Period" class="btn btn-link btn-sm extend-trial-period" href="javascript:void(0)" onclick="ExtendTimeperiod(@clientdata.AB_UserID)">
                            <i class='bx bx-time-five text-primary'></i>
                            </a>
                            <a type="button" title="Delete" data-toggle="modal" href="#DeleteAward" onclick="Clientdeleteid('@clientdata.AB_MainID')" class="btn btn-link btn-sm delete">
                            <i class="fa fa-trash text-danger" aria-hidden="true"></i>
                            </a>
                            </td>
                            </tr>
                            }
                            }*@

                            @if (Model != null)
                            {
                                @foreach (var clientdata in Model.ToList())
                                {
                                    <tr>
                                        @*<td style="text-align:left;">@clientdata.CreatedDate</td>*@
                                        <td style="text-align:left;"><a href="~/Admin/CustSubscription/ClientProfile?ClientId=@clientdata.AB_UserID&Clientstatus=@ViewBag.Status">@clientdata.FormatedName</a></td>
                                        <td  style="text-align:left;"><a href="~/Admin/CustSubscription/ClientProfile?ClientId=@clientdata.AB_UserID&Clientstatus=@ViewBag.Status">@clientdata.Email</a></td>
                                        <td  style="text-align:left;">@clientdata.CountryName</td>
                                       @* <td  style="text-align:left;">@clientdata.StateName</td>
                                        <td  style="text-align:left;">@clientdata.CityName</td>*@
                                        <td  style="text-align:left;">@clientdata.StartDateFormat</td>
                                        <td  style="text-align:left;">@clientdata.EndDateFormat</td>
                                        <td style="text-align:left;">@clientdata.CreatedDate</td>

                                        @if (clientdata.StatusName == "Active")
                                        {
                                            <td  style="text-align:left;">
                                                <a href="#active_modal" data-toggle="modal" class="activate" style="color:green;">@clientdata.StatusName</a>
                                            </td>
                                        }
                                        else if (clientdata.StatusName == "In-Active")
                                        {
                                            <td  style="text-align:left;">
                                                <a href="#active_modal" data-toggle="modal" class="activate" style="color:red;">Inactive</a>
                                            </td>
                                        }
                                        else if (clientdata.StatusName == "Trial")
                                        {
                                            <td  style="text-align:left;">
                                                <a href="#active_modal" data-toggle="modal" class="activate" style="color:green;">Trial</a>
                                            </td>
                                        }
                                        else if (clientdata.StatusName == "Trial Ended Not Subscribed")
                                        {
                                            <td  style="text-align:left;">
                                                <a href="#active_modal" data-toggle="modal" class="activate" style="color:red;">Trial Ended Not Subscribed</a>
                                            </td>
                                        }
                                        else if (clientdata.StatusName == "Suspend")
                                        {
                                            <td  style="text-align:left;">
                                                <a href="#active_modal" data-toggle="modal" class="activate" style="color:red;">Suspend</a>
                                            </td>
                                        }
                                         else if (clientdata.StatusName == "Deleted")
                                        {
                                            <td  style="text-align:left;">
                                                <a href="#active_modal" data-toggle="modal" class="activate" style="color:red;">Deleted</a>
                                            </td>
                                        }
                                        <td class="actionsbtn">
                                            <a type="button" title="Reminder" class="btn btn-link btn-sm reminder" href="javascript:void(0)" onclick="SendMailNotification(@clientdata.AB_UserID)">
                                                <i class='bx bxs-bell-ring text-danger'></i>
                                            </a>


                                            @if (clientdata.StatusName == "Active")
                                            {
                                                <a type="button" title="Suspend" class="btn btn-link btn-sm suspend" href="javascript:void(0)" onclick="Suspend(@clientdata.AB_UserID)">
                                                    <i class='bx bx-pause-circle text-success font-size-18'></i>
                                                </a>
                                            }
                                             @if (clientdata.StatusName == "Trial")
                                            {
                                                <a type="button" title="Suspend" class="btn btn-link btn-sm suspend" href="javascript:void(0)" onclick="Suspend(@clientdata.AB_UserID)">
                                                    <i class='bx bx-pause-circle text-success font-size-18'></i>
                                                </a>
                                            }

                                             @if (clientdata.StatusName == "Trial Ended Not Subscribed")
                                            {
                                                <a type="button" title="Suspend" class="btn btn-link btn-sm suspend" href="javascript:void(0)" onclick="Suspend(@clientdata.AB_UserID)">
                                                    <i class='bx bx-pause-circle text-success font-size-18'></i>
                                                </a>
                                            }


                                            @if (clientdata.StatusName == "Suspend")
                                            {
                                                <a type="button" title="Active" class="btn btn-link btn-sm active-btn" href="javascript:void(0)" onclick="ActiveClient(@clientdata.AB_UserID)">
                                                    <i class='bx bxs-check-circle'></i>
                                                </a>
                                            }
                                              @if (clientdata.StatusName == "Deleted")
                                            {
                                                <a type="button" title="Active" class="btn btn-link btn-sm active-btn" href="javascript:void(0)" onclick="ActiveClient(@clientdata.AB_UserID)">
                                                    <i class='bx bxs-check-circle'></i>
                                                </a>
                                            }

                                           
                                           @* <a type="button" title="Extend trial Period" class="btn btn-link btn-sm extend-trial-period" href="javascript:void(0)" onclick="ExtendTimeperiod(@clientdata.AB_UserID)">
                                                <i class='bx bx-time-five text-primary'></i>
                                            </a>*@
                                            <a type="button" title="Delete" data-toggle="modal" href="#DeleteAward" onclick="Clientdeleteid('@clientdata.AB_MainID')" class="btn btn-link btn-sm delete">
                                                <i class="fa fa-trash text-danger" aria-hidden="true"></i>
                                            </a>
                                        </td>
                                    </tr>

                                }
                            }

                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
</div>


<form id="ModelfromValidation">
    <div class="modal fade" id="DeleteAward" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><b>Delete Client</b></h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-times"></i></span></button>
                </div>
                <div class="modal-body">
                    <h6> Are you sure you want to delete this client </h6>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" id="btnCancel" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger btn-sm" id="btnsubmit" onclick="return RemoveClient();">Delete</button>
                </div>
            </div>
        </div>
    </div>
</form>




<script type="text/javascript">
    $(document).ready(function() {

        $('#clientdetails').dataTable({
            "pagingType": "full_numbers",
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
            order: [[0, 'desc']],
        });
        setSelectByValue('ActiveDDL', '@ViewBag.Status')
    });



    function setSelectByValue(eID, val) {
        debugger;
        var ele = document.getElementById(eID);
        for (var ii = 0; ii < ele.length; ii++)
            if (ele.options[ii].value == val) { //Found!
                ele.options[ii].selected = true;
                return true;
            }
        return false;
    }


    var clientiddata = null;
    function Clientdeleteid(Clientidclick) {
        clientiddata = Clientidclick;
    }


    function RemoveClient() {
        debugger;
        var id = clientiddata;
        $.ajax({
            type: "POST",
            url: "/Admin/CustSubscription/DeletClient?" + $.param({ clientid: clientiddata }),
            data: id,
            success: function(result) {
                $('#DeleteAward').modal('hide');
                clientiddata = null;
                $('.modal-backdrop').css('display', 'none');
                if (result !== null) {
                    swal("Thanks!", "Client Has Been Deleted!", "success");
                     var statusval = $("#ActiveDDL").val();
                     GetClientList(statusval);
                   // location.reload();
                }
                else {

                    swal("OOPS!", "Something Went Wrong", "error");
                    $('.sweet-alert h2 ').css('color', '#FF0000');
                    $('.sweet-alert p').css('color', '#000000');
                }
            }
        });
    }


    $("#ActiveDDL").change(function() {

        var statusval = $("#ActiveDDL").val();
        GetClientList(statusval);
        //$.ajax({
        //    type: "POST",
        //    url: "/Admin/CustSubscription/Activeclients?" + $.param({ status: statusval }),
        //    data: statusval,
        //    success: function(result) {
        //        debugger;
        //        $("#clientdetails").dataTable().fnDestroy();

        //        $('#clientdetails tbody').empty();

        //        $('#clientdetails tbody').append(result);

        //        $('#clientdetails').dataTable({

        //            "pagingType": "full_numbers",
        //            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]], columnDefs: [{
        //                "defaultContent": "-",
        //                "targets": "_all"
        //            }]
        //        });

        //    }
        //});

    });

function GetClientList(statusval) {
     $.ajax({
            type: "POST",
            url: "/Admin/CustSubscription/Activeclients?" + $.param({ status: statusval }),
            data: statusval,
            success: function(result) {
                debugger;
                $("#clientdetails").dataTable().fnDestroy();

                $('#clientdetails tbody').empty();

                $('#clientdetails tbody').append(result);

                $('#clientdetails').dataTable({

                    "pagingType": "full_numbers",
                    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]], columnDefs: [{
                        "defaultContent": "-",
                        "targets": "_all"
                    }]
                });

            }
        });
}



    function SendMailNotification(userid) {
        debugger;
        $("body").addClass("loading");
        var Userid = userid;
        $.ajax({
            type: "POST",
            url: "/Admin/CustSubscription/SendNotificationAlert?" + $.param({ Userid: Userid }),
            data: Userid,
            success: function(result) {
                debugger;
                $("body").removeClass("loading");
                if (result == "Done") {
                    swal("Thanks!", "Notification has been sent successfully", "success");
                }

            }
        });

    }

    function ExtendTimeperiod(userid) {
        debugger;
        var Userid = userid;
        $.ajax({
            type: "POST",
            url: "/Admin/CustSubscription/ExtendTimeperiod?" + $.param({ Userid: Userid }),
            data: Userid,
            success: function(result) {
                debugger;

                if (result == "Done") {
                    swal("Thanks!", "Time has been Updated Successfuly", "success");
                }

            }
        });

    }


    function Suspend(userid) {
        debugger;
        var Userid = userid;
        $.ajax({
            type: "POST",
            url: "/Admin/CustSubscription/Suspend?" + $.param({ Userid: Userid }),
            data: Userid,
            success: function(result) {
                debugger;

                if (result == "Done") {
                    swal("Thanks!", "User has been Suspended Successfully", "success");
                     var statusval = $("#ActiveDDL").val();
                      GetClientList(statusval);
                }

            }
        });

    }

    function ActiveClient(userid) {
        debugger;
        var Userid = userid;
        $.ajax({
            type: "POST",
            url: "/Admin/CustSubscription/ActiveClientStatus?" + $.param({ Userid: Userid }),
            data: Userid,
            success: function(result) {
                debugger;

                if (result == "Done") {
                     var statusval = $("#ActiveDDL").val();
                      GetClientList(statusval);
                    swal("Thanks!", "User has been Activated Successfully", "success");
                }

            }
        });

    }


</script>

<script>
    $(".sidebar-section #lm_Admin").addClass('active');
</script>
